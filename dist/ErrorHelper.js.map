{"version":3,"sources":["ErrorHelper.js"],"names":["_ConsoleHelper","_interopRequireDefault","require","_StringBuilder","_StringHelper","_Environment","_JsonHelper","_Localize","_IUtilityTypes","ErrorHelper","__printExceptionTo","e","sb","appendLine","name","message","stack","JsonHelper","toJson","append","__printException","StringBuilder","_errorArgument","kind","paramName","Localize","to","create","_error","innerException","data","err","Error","argument","argumentNull","actualValue","StringHelper","format","displayMessage","argumentUndefined","invalidOperation","notImplemented","configException","systemException","userException","passException","isPassException","ex","constructor","dispose","parameterCount","datas","referencedDatas","length","ConsoleHelper","error","join","log","href","Environment","__processError","writeLog","LoggerLevelEnum"],"mappings":"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","file":"ErrorHelper.js","sourcesContent":["import ConsoleHelper from \"./ConsoleHelper\";\nimport StringBuilder from \"./StringBuilder\";\nimport StringHelper from \"./StringHelper\";\nimport Environment from \"./Environment\";\nimport JsonHelper from \"./JsonHelper\";\nimport Localize from \"./Localize\";\nimport { LoggerLevelEnum } from \"./IUtilityTypes\";\n/**\n * 异常错误对象\n */\nvar ErrorHelper = /** @class */ (function () {\n    function ErrorHelper() {\n    }\n    /**\n     * 打印异常信息\n     * @param e 服务端异常对象\n     * @param sb\n     */\n    ErrorHelper.__printExceptionTo = function (e, sb) {\n        sb.appendLine(\"异常类型：\", e.name).appendLine(\"异常消息：\", e.message);\n        if (e.stack) {\n            sb.appendLine(\"堆栈信息：\").appendLine(e.stack);\n        }\n        if (e[\"data\"]) {\n            sb.appendLine(\"异常数据：\").appendLine(JsonHelper.toJson(e[\"data\"]));\n        }\n        if (e[\"innerException\"]) {\n            sb.append(\"内部异常：\");\n            ErrorHelper.__printExceptionTo(e[\"innerException\"], sb);\n        }\n    };\n    /**\n     * 打印异常信息\n     * @param e 服务端异常对象\n     */\n    ErrorHelper.__printException = function (e) {\n        if (e.name === \"BusinessException\") {\n            return e.message;\n        }\n        var sb = new StringBuilder();\n        ErrorHelper.__printExceptionTo(e, sb);\n        return sb.toString();\n    };\n    /**\n     * 创建参数异常对象\n     * @param kind 参数异常类型\n     * @param paramName 参数名称\n     * @param message 异常消息\n     * @returns 返回Error对象\n     */\n    ErrorHelper._errorArgument = function (kind, paramName, message) {\n        var name = \"Argument\" + kind + \"Exception\";\n        if (paramName) {\n            message += \"\\n\" + Localize.to(\"参数名：{0}。\", paramName);\n        }\n        return ErrorHelper.create(name, message, \"\", null, { paramName: paramName });\n    };\n    /**\n     * 创建异常对象\n     * @param kind 异常类型\n     * @param message 异常消息\n     * @returns 返回Error对象\n     */\n    ErrorHelper._error = function (kind, message) {\n        return ErrorHelper.create(kind + \"Exception\", message, \"\");\n    };\n    /**\n     * 创建一个Error对象\n     * @param name 异常名称\n     * @param message 错误消息\n     * @param stack 堆栈信息\n     * @param innerException 内部错误对象\n     * @param data 错误的具体信息.默认为null\n     * @returns 返回Error对象\n     */\n    ErrorHelper.create = function (name, message, stack, innerException, data) {\n        var err = new Error();\n        err.name = name;\n        err.message = message;\n        if (stack) {\n            err.stack = stack;\n        }\n        if (innerException) {\n            err[\"innerException\"] = innerException;\n        }\n        if (data) {\n            err[\"data\"] = data;\n        }\n        return err;\n    };\n    /**\n     * 创建一个参数错误异常\n     * @param paramName 参数名称\n     * @param message 异常消息\n     * @returns 返回一个ArgumentException异常对象\n     */\n    ErrorHelper.argument = function (paramName, message) {\n        return ErrorHelper._errorArgument(\"\", paramName, message || \"值并不在预期的范围内。\");\n    };\n    /**\n     * 创建一个空值参数异常对象\n     * @param paramName 参数名称\n     * @param message 异常消息\n     * @returns 返回一个ArgumentNullException异常对象\n     */\n    ErrorHelper.argumentNull = function (paramName, message) {\n        return ErrorHelper._errorArgument(\"Null\", paramName, message || \"值不能为null。\");\n    };\n    /**\n     * 创建一个参数值超出运行范围的异常对象\n     * @param paramName 参数名称\n     * @param actualValue 该参数的实际值.默认为null\n     * @param message 异常具体消息\n     * @returns 返回一个ArgumentOutOfRangeException异常对\n     */\n    ErrorHelper.argumentOutOfRange = function (paramName, actualValue, message) {\n        var displayMessage = message || \"值在有效范围之外。\";\n        if (paramName) {\n            displayMessage += \"\\n\" + StringHelper.format(\"参数名：{0}。\", paramName);\n        }\n        if (typeof actualValue !== \"undefined\" && actualValue !== null) {\n            displayMessage += \"\\n\" + StringHelper.format(\"实际值是：{0}。\", actualValue);\n        }\n        return ErrorHelper.create(\"ArgumentOutOfRangeException\", displayMessage, \"\", null, {\n            paramName: paramName,\n            actualValue: actualValue\n        });\n    };\n    /**\n     * 创建一个参数未定义的异常\n     * @param paramName 参数名称\n     * @param message 错误的消息\n     * @returns 返回一个ArgumentUndefinedException异常对象\n     */\n    ErrorHelper.argumentUndefined = function (paramName, message) {\n        return ErrorHelper._errorArgument(\"Undefined\", paramName, message || \"值不能为未定义。\");\n    };\n    /**\n     * 创建一个格式错误的异常\n     * @param message 错误的消息\n     * @returns 返回一个FormatException异常对象\n     */\n    ErrorHelper.format = function (message) {\n        return ErrorHelper._error(\"Format\", message || \"一个无效的格式。\");\n    };\n    /**\n     * 创建无效操作异常\n     * @param message 错误的消息\n     * @returns 返回一个InvalidOperationException异常对象\n     */\n    ErrorHelper.invalidOperation = function (message) {\n        return ErrorHelper._error(\"InvalidOperation\", message || \"一个无效的操作。\");\n    };\n    /**\n     * 创建一个没有实现的异常\n     * @param message 错误的消息\n     * @returns 返回一个NotImplementedException异常对象\n     */\n    ErrorHelper.notImplemented = function (message) {\n        return ErrorHelper._error(\"NotImplemented\", message || \"当前方法或操作没有实现。\");\n    };\n    /**\n     * 创建一个没有实现的异常\n     * @param message 错误的消息\n     * @returns 返回一个NotImplementedException异常对象\n     */\n    ErrorHelper.notSupported = function (message) {\n        return ErrorHelper._error(\"NotSupported\", message || \"不支持当前操作。\");\n    };\n    /**\n     * 创建一个参数个数异常\n     * @param message 错误的消息\n     * @returns 返回一个ParameterCountException异常对象\n     */\n    ErrorHelper.parameterCount = function (message) {\n        return ErrorHelper._error(\"ParameterCount\", message || \"参数个数不匹配。\");\n    };\n    /**\n     * 创建一个配置异常\n     * @param message 错误的消息\n     * @returns 返回一个ConfigException异常对象\n     */\n    ErrorHelper.configException = function (message) {\n        return ErrorHelper._error(\"Config\", message || \"配置异常。\");\n    };\n    /**\n     * 创建一个配置异常\n     * @returns 返回一个SystemException异常对象\n     */\n    ErrorHelper.systemException = function (message) {\n        return ErrorHelper._error(\"System\", message || \"操作失败，请联系系统管理员！\");\n    };\n    /**\n     * 创建一个用户提示异常\n     * @returns 返回一个UserException异常对象\n     */\n    ErrorHelper.userException = function (message) {\n        return ErrorHelper._error(\"User\", message);\n    };\n    /**\n     * 创建一个忽略后续操作异常\n     * @returns 返回一个PassException异常对象\n     */\n    ErrorHelper.passException = function () {\n        return ErrorHelper._error(\"Pass\", \"用于终止后面的操作。\");\n    };\n    /**\n     * 判断一个异常对象是否为一个pass异常\n     * @param ex 需要判断的异常\n     */\n    ErrorHelper.isPassException = function (ex) {\n        return ex && ex.constructor === Error && ex.name === \"PassException\";\n    };\n    /**\n     * 捕获所有的异常,并抛出pass异常\n     * @param ex 需要捕获的异常\n     */\n    ErrorHelper.disposeThrowPass = function (ex) {\n        if (ex.name === \"PassException\") {\n            throw ex;\n        }\n        ErrorHelper.dispose(ex);\n        throw ErrorHelper.passException();\n    };\n    /**\n     * 异常处理.如果是\"UserException\"异常,则会直接弹出异常信息;否则会写入异常日志,并弹出\"操作失败，请关闭重试！\"\n     * @param ex 异常对象\n     */\n    ErrorHelper.dispose = function (ex) {\n        if (!ex) {\n            return;\n        }\n        switch (ex.name) {\n            case \"PassException\":\n                return;\n            case \"BusinessException\":\n            case \"UserException\":\n                switch (ex.type) {\n                    case \"ReferencedDataException\":\n                        {\n                            var datas = ex.referencedDatas;\n                            if (datas.length > 5) {\n                                datas[5] = \"等\";\n                            }\n                            ConsoleHelper.error(ex.message + \"-被使用的数据：\" + datas.join(\"，\"));\n                        }\n                        break;\n                    default:\n                        // UI.Dialogs.warn(ex.message);\n                        ConsoleHelper.log(ex.message);\n                        break;\n                }\n                break;\n            case \"ClientDisposeException\":\n                // UI.Dialogs.warn(ex.message);\n                ConsoleHelper.log(ex.message);\n                if (ex[\"logout\"]) {\n                    window.location.href = \"index.html\";\n                }\n                break;\n            case \"SystemException\":\n            case \"AuthorizationException\":\n            case \"OpenDBConnectionException\":\n                // UI.Dialogs.error(ex.message);\n                ConsoleHelper.error(ex.message);\n                break;\n            case \"Exception\":\n                Environment.__processError(ex);\n                break;\n            default:\n                Environment.writeLog(LoggerLevelEnum.Error, ex);\n                Environment.__processError(ex);\n                break;\n        }\n    };\n    return ErrorHelper;\n}());\nexport default ErrorHelper;\n"]}