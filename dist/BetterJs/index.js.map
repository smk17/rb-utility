{"version":3,"sources":["BetterJs/index.js"],"names":["require","_utils","_interopRequireDefault","BetterJs","utils","init","options","config","objectMerge","jsError","resourceError","ajaxError","consoleError","scriptError","autoReport","filters","levels","category","defaultConfig","push","test","arguments","sendError","title","msg","level","tags","that_1","this","some","func","isFunction","apply","_oldSendError","e","_window","window","isFilter","global","self","handleWindowError","handleRejectPromise","addEventListener","handleResourceError","handleAjaxError"],"mappings":"2FAAAA,QAAA,gBACA,IAAAC,OAAAC,uBAAAF,QAAA,oFACA,IAAIG,SAA0B,WAC1B,SAASA,KAsDDC,OApDRD,EAASE,KAAO,SAAUC,GACtB,IAWIC,EAASH,OAAAA,QAAMI,YAXC,CAN5BC,SAAA,EAQYC,eAAe,EAP3BC,WAAA,EASYC,cAAc,EACdC,aAAa,EACbC,YAAY,EAVZC,QAAA,GAAGC,OAAA,CAAA,OAAA,UAAA,SAA2BC,SAAA,CAAA,KAAA,WAAA,SAeYX,GAZzCD,EAAOQ,aACRK,EAAAA,QAAgBC,KAAA,WACP,MADO,oBAAAC,KAAAC,UAAA,MAKhBR,IAAAA,EALgBN,EAAAe,UAMhBR,EAAAA,UANgB,SAAAS,EAAAC,EAAAC,EAAAR,EAAAS,GAOhBX,IACS,IAAAY,EAAQC,KAGX,GAFWrB,EAAYQ,QAAnBc,KAAA,SAAAC,GATd,OAAA1B,OAAAA,QAAA2B,WAAAD,IAAAA,EAAAE,MAAAL,EAAAN,aA0BY,OAZG,GADJN,EAAaiB,MAAAJ,KAAYP,WACrBd,EAAAO,WADX,OAKAmB,MAAAA,GAiBIA,EAAc,CAhBtBV,MAAmB,WACXC,IAAAU,EACUjB,SAAV,SAqBR,IAAIkB,EAA4B,oBAAXC,OAjBTC,OACA,oBAAAC,OACHA,OAmBiB,oBAATC,KAlBKP,KAoBR,GAnBFzB,EAAmB4B,EAAA,kBAAAA,EAAA,YACnB5B,EAAAE,SAEJL,OAAAA,QAAAoC,kBAAAL,EAAA5B,GAEJA,EAAUE,SAEFc,OAAAA,QAAOkB,oBADGN,EAAA5B,GAGVU,EAAQP,eAAEgC,GAHdtC,OAAAA,QAAAuC,oBAAAR,EAAA5B,GAhBRA,EAAAI,WA0CIP,OAAAA,QAAMwC,gBAAgBT,EAAS5B,GAE/BA,EAAOK,cAdP8B,OAAAA,QAAAA,mBAA2BP,EAAA5B,IAE3BH,EAvDkB,YAyEfD","file":"index.js","sourcesContent":["import \"whatwg-fetch\";\nimport utils from \"./utils\";\nvar BetterJs = /** @class */ (function () {\n    function BetterJs() {\n    }\n    BetterJs.init = function (options) {\n        var defaultConfig = {\n            jsError: true,\n            resourceError: true,\n            ajaxError: true,\n            consoleError: true,\n            scriptError: false,\n            autoReport: true,\n            filters: [],\n            levels: [\"info\", \"warning\", \"error\"],\n            category: [\"js\", \"resource\", \"ajax\"]\n        };\n        var config = utils.objectMerge(defaultConfig, options);\n        if (!config.scriptError) {\n            config.filters.push(function () {\n                return /^Script error\\.?$/.test(arguments[0]);\n            });\n        }\n        // 处理过滤器\n        var _oldSendError = config.sendError;\n        config.sendError = function (title, msg, level, category, tags) {\n            try {\n                var that_1 = this;\n                var isFilter = config.filters.some(function (func) {\n                    return utils.isFunction(func) && func.apply(that_1, arguments);\n                });\n                if (isFilter) {\n                    return;\n                }\n                _oldSendError.apply(this, arguments);\n                if (config.autoReport) {\n                    return;\n                }\n                // TODO ajax上报\n            }\n            catch (e) {\n                _oldSendError({\n                    title: \"BetterJs\",\n                    msg: e,\n                    category: \"js\"\n                });\n            }\n        };\n        var _window = typeof window !== \"undefined\"\n            ? window\n            : typeof global !== \"undefined\"\n                ? global\n                : typeof self !== \"undefined\"\n                    ? self\n                    : {};\n        var addEventListener = _window[\"addEventListener\"] || _window[\"attachEvent\"];\n        if (config.jsError) {\n            utils.handleWindowError(_window, config);\n        }\n        if (config.jsError) {\n            // https://developer.mozilla.org/zh-CN/docs/Web/Events/unhandledrejection\n            utils.handleRejectPromise(_window, config);\n        }\n        if (config.resourceError && addEventListener) {\n            utils.handleResourceError(_window, config);\n        }\n        if (config.ajaxError) {\n            utils.handleAjaxError(_window, config);\n        }\n        if (config.consoleError) {\n            utils.handleConsoleError(_window, config);\n        }\n    };\n    return BetterJs;\n}());\nexport default BetterJs;\n"]}