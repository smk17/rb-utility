"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0,require("whatwg-fetch");var _JsonHelper=_interopRequireDefault(require("../JsonHelper"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _oldWindowError=null,windowError=null;function isFunction(e){return"function"==typeof e}function isUndefined(e){return void 0===e}function hasKey(e,r){return Object.prototype.hasOwnProperty.call(e,r)}function each(e,r){var t,o;if(isUndefined(e.length))for(t in e)hasKey(e,t)&&r.call(null,t,e[t]);else if(o=e.length)for(t=0;t<o;t++)r.call(null,t,e[t])}function objectMerge(t,e){return e&&each(e,function(e,r){t[e]=r}),t}var handleWindowError=function(e,s){_oldWindowError=e.onerror,e.onerror=function(e,r,t,o,n){n&&n.stack?s.sendError({title:e,msg:n.stack,category:"js",level:"error"}):"string"==typeof e&&s.sendError({title:e,msg:_JsonHelper.default.toJson({resourceUrl:r,rowNum:t,colNum:o}),category:"js",level:"error"}),_oldWindowError&&isFunction(_oldWindowError)&&windowError&&windowError.apply(window,arguments)}},handleRejectPromise=function(e,t){e.addEventListener("unhandledrejection",function(e){if(e){var r=e.reason;t.sendError({title:"unhandledrejection",msg:r,category:"js",level:"error"})}},!0)},handleResourceError=function(e,o){e.addEventListener("error",function(e){if(e){var r=e.target||e.srcElement;if(!(r instanceof HTMLScriptElement||r instanceof HTMLLinkElement||r instanceof HTMLImageElement))return;var t=r.src||r.href;o.sendError({title:r.nodeName,msg:t,category:"resource",level:"error"})}},!0)},_handleFetchError=function(e,r){if(e.fetch){var t=e.fetch;e.fetch=function(){return t.apply(this,arguments).then(function(e){return e.ok||r.sendError({title:e,msg:_JsonHelper.default.toJson(e),category:"ajax",level:"error"}),e}).catch(function(e){throw r.sendError({title:e,msg:_JsonHelper.default.toJson({message:e.message,stack:e.stack}),category:"ajax",level:"error"}),e})}}},handleAjaxError=function(e,r){if("file:"!==e.location.protocol&&(_handleFetchError(e,r),e.XMLHttpRequest)){var t=e.XMLHttpRequest,o=t.prototype.send,n=function(e){e&&e.currentTarget&&200!==e.currentTarget.status&&r.sendError({title:e.target.responseURL,msg:_JsonHelper.default.toJson({response:e.target.response,responseURL:e.target.responseURL,status:e.target.status,statusText:e.target.statusText}),category:"ajax",level:"error"})};t.prototype.send=function(){if(this.addEventListener)this.addEventListener("error",n),this.addEventListener("load",n),this.addEventListener("abort",n);else{var r=this.onreadystatechange;this.onreadystatechange=function(e){4===this.readyState&&n(e),r&&r.apply(this,arguments)}}return o.apply(this,arguments)}}},handleConsoleError=function(e,r){if(e.console&&e.console.error){var t=e.console.error;e.console.error=function(){r.sendError({title:"consoleError",msg:_JsonHelper.default.toJson(arguments),category:"js",level:"error"}),t&&t.apply(e,arguments)}}},_default={isFunction:isFunction,objectMerge:objectMerge,handleWindowError:handleWindowError,handleRejectPromise:handleRejectPromise,handleConsoleError:handleConsoleError,handleResourceError:handleResourceError,handleAjaxError:handleAjaxError};exports.default=_default;
//# sourceMappingURL=utils.js.map
